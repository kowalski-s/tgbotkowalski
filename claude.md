# Telegram Bot для лид-генерации

## Описание проекта
Telegram бот для привлечения подписчиков на канал с выдачей бонусных материалов и двусторонней связью с администратором.

## Технологический стек
- Python 3.11+
- aiogram 3.x (современная асинхронная библиотека для Telegram Bot API)
- SQLite (легковесная БД для хранения данных пользователей)
- Docker + Docker Compose (для деплоя)
- python-dotenv (для работы с переменными окружения)

## Функциональность

### 1. Воронка подписки (/start)
- Пользователь запускает бота командой /start
- Бот отправляет сообщение с просьбой подписаться на канал
- Кнопка "Я подписался" → проверка подписки через Bot API
- После подтверждения подписки:
  - Отправка ссылки на статью
  - Отправка PDF файла (бонус)
  - Сообщение о работе с владельцем

### 2. Двусторонняя связь
- Пользователь пишет сообщение в бота
- Администратор получает уведомление с текстом и информацией о пользователе
- Администратор может ответить через специальную команду
- **База данных необходима** для:
  - Хранения user_id пользователей
  - Отслеживания статуса подписки
  - Логирования сообщений
  - Статистики

### 3. Статистика
- Общее количество пользователей, запустивших бота
- Количество подтвердивших подписку
- Количество получивших файл
- Активность пользователей

## Структура базы данных (SQLite)

### Таблица: users
- id (INTEGER PRIMARY KEY)
- user_id (INTEGER UNIQUE) - Telegram ID
- username (TEXT) - @username
- first_name (TEXT)
- last_name (TEXT)
- is_subscribed (BOOLEAN) - подтвержденная подписка
- received_file (BOOLEAN) - получил PDF
- created_at (TIMESTAMP)
- last_active (TIMESTAMP)

### Таблица: messages (опционально)
- id (INTEGER PRIMARY KEY)
- user_id (INTEGER)
- message_text (TEXT)
- is_from_admin (BOOLEAN)
- created_at (TIMESTAMP)

## Архитектура проекта

```
tgbotkowalski/
├── bot/
│   ├── __init__.py
│   ├── main.py              # Точка входа
│   ├── config.py            # Конфигурация из .env
│   ├── handlers/            # Обработчики команд и сообщений
│   │   ├── __init__.py
│   │   ├── start.py         # Команда /start и проверка подписки
│   │   ├── admin.py         # Команды администратора
│   │   └── messages.py      # Обработка пользовательских сообщений
│   ├── keyboards/           # Клавиатуры
│   │   ├── __init__.py
│   │   └── inline.py        # Inline кнопки
│   ├── database/            # Работа с БД
│   │   ├── __init__.py
│   │   ├── models.py        # Модели данных
│   │   └── db.py            # Подключение и запросы
│   └── utils/               # Утилиты
│       ├── __init__.py
│       └── checks.py        # Проверка подписки
├── data/                    # Файлы для отправки
│   └── bonus.pdf
├── .env                     # Переменные окружения (НЕ в git!)
├── .env.example             # Пример файла .env
├── .gitignore
├── requirements.txt
├── Dockerfile
├── docker-compose.yml
├── README.md
└── claude.md               # Этот файл
```

## План разработки

### Этап 1: Базовая настройка (1-2 часа)
- [x] Создание структуры проекта
- [ ] Настройка .env и переменных окружения
- [ ] Создание requirements.txt
- [ ] Инициализация SQLite базы данных

### Этап 2: Основная функциональность (3-4 часа)
- [ ] Реализация команды /start
- [ ] Проверка подписки на канал
- [ ] Отправка ссылки и PDF файла
- [ ] Сохранение пользователей в БД

### Этап 3: Двусторонняя связь (2-3 часа)
- [ ] Обработка входящих сообщений от пользователей
- [ ] Уведомления администратору
- [ ] Команды для ответа пользователям
- [ ] Логирование сообщений

### Этап 4: Статистика (1-2 часа)
- [ ] Команда /stats для администратора
- [ ] Подсчет пользователей и конверсии
- [ ] Экспорт данных (опционально)

### Этап 5: Деплой (2-3 часа)
- [ ] Создание Dockerfile
- [ ] Настройка docker-compose.yml
- [ ] Деплой на cloud.ru VPS через dokploy
- [ ] Настройка автозапуска и мониторинга

## Переменные окружения (.env)

```env
# Telegram Bot
BOT_TOKEN=your_bot_token_here
ADMIN_ID=your_telegram_user_id
CHANNEL_ID=@your_channel_username  # или -100123456789
CHANNEL_LINK=https://t.me/your_channel

# Контент
ARTICLE_LINK=https://your-article-link.com
PDF_FILE_PATH=./data/bonus.pdf

# База данных
DATABASE_PATH=./data/bot.db

# Сообщения
WELCOME_MESSAGE=Привет! Для получения статьи подпишись на мой канал.
SUCCESS_MESSAGE=Отлично! Вот твоя статья и бонус.
```

## Особенности для России

1. **VPS в России (cloud.ru)** - нет проблем с доступом к Telegram Bot API
2. **Нет необходимости в VPN** - Bot API работает без ограничений
3. **Dokploy** - удобная панель для управления Docker контейнерами

## Требования к серверу

- ✅ 2 vCPU (достаточно)
- ✅ 4 ГБ RAM (отлично для этой задачи)
- ✅ 30 ГБ диск (более чем достаточно)

Ожидаемое использование ресурсов:
- RAM: ~100-200 МБ
- CPU: минимальное (пиковые нагрузки при массовых рассылках)
- Диск: ~50-100 МБ (бот + БД + логи)

## Безопасность

- ✅ .env файл в .gitignore
- ✅ Проверка прав администратора
- ✅ Валидация входящих данных
- ✅ Логирование действий
- ✅ Ограничение по частоте запросов (rate limiting)

## Масштабирование

При росте аудитории (>10,000 активных пользователей):
- Переход на PostgreSQL
- Использование Redis для кэширования
- Разделение на микросервисы

Но для старта SQLite + текущая архитектура оптимальны.

## Полезные команды администратора

- `/start` - запуск бота для обычных пользователей
- `/stats` - статистика по пользователям
- `/broadcast` - рассылка сообщений (опционально)
- `/reply <user_id> <text>` - ответить пользователю

## Следующие шаги

1. Создать бота через @BotFather в Telegram
2. Получить токен бота
3. Узнать свой admin_id (можно через @userinfobot)
4. Получить ID канала (бот должен быть админом канала)
5. Подготовить PDF файл для отправки
6. Запустить разработку по этапам выше
